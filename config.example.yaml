# Example configuration for Cloud API Gateway
# Copy this file to config.yaml and customize for your environment

server:
  port: 8080
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

keycloak:
  # Keycloak token introspection endpoint
  # Replace {realm} with your Keycloak realm name
  introspection_url: "https://keycloak.example.com/realms/{realm}/protocol/openid-connect/token/introspect"
  client_id: "gateway-client"
  # Use environment variable substitution for secrets
  # Format: ${VAR_NAME} or ${VAR_NAME:-default_value}
  client_secret: "${KEYCLOAK_CLIENT_SECRET}"
  timeout: 5s

cache:
  enabled: true
  # Token cache TTL - caches introspection results to reduce Keycloak load
  ttl: 60s

routes:
  # Example: User API route
  - name: "user-api"
    # Regex pattern to match request paths
    path_pattern: "^/api/v1/users(/.*)?$"
    # Allowed HTTP methods (empty means all methods)
    methods: ["GET", "POST", "PUT", "DELETE"]
    # Upstream service URL
    upstream: "http://user-service:8080"
    # Prefix to strip from path before forwarding to upstream
    strip_prefix: "/api/v1"
    # Required roles (OR logic by default)
    required_roles: ["user:read", "user:write"]
    # Set to true for AND logic (user must have ALL roles)
    require_all_roles: false

  # Example: Admin API route with AND logic
  - name: "admin-api"
    path_pattern: "^/api/v1/admin(/.*)?$"
    upstream: "http://admin-service:8080"
    required_roles: ["admin", "superuser"]
    # User must have BOTH admin AND superuser roles
    require_all_roles: true

  # Example: Public API route (no authentication required)
  - name: "public-api"
    path_pattern: "^/api/v1/public(/.*)?$"
    upstream: "http://public-service:8080"
    # No required_roles means public access

  # Example: Health check endpoint (no authentication)
  - name: "health"
    path_pattern: "^/health$"
    methods: ["GET"]
    upstream: "http://health-service:8080"

